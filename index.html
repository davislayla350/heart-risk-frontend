<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Character encoding -->
    <meta charset="UTF-8" />

    <!-- Page title -->
    <title>Heart Disease Risk Assessment</title>

    <!-- Google Fonts preconnect and import -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?display=swap&family=Lexend:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900"
    />

    <!-- Tailwind CSS with plugins for forms and container queries -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>
  <body class="bg-[#fcf8f8] font-sans min-h-screen flex items-center justify-center px-4 py-10">
    <!-- Main card container -->
    <div class="bg-white shadow-2xl rounded-2xl p-8 w-full max-w-4xl">
      <!-- Heading -->
      <h1 class="text-3xl font-bold text-[#1c0d0d] mb-4">‚ù§Ô∏è Heart Disease Risk Assessment ‚ù§Ô∏è</h1>

      <!-- Subheading -->
      <p class="text-[#9c4949] mb-8">Enter your health information to assess your risk of heart disease.</p>
      
      <!-- Form starts -->
      <form id="predictForm" action="/predict" method="post" class="space-y-6">
        <!-- Age input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Age <span class="text-sm text-[#9c4949] font-normal">(Risk increases with age. Model considers 28‚Äì77 years)</span>
          </label>
          <input type="number" name="Age" placeholder="e.g. 45" min="28" max="77" class="w-full rounded-xl bg-[#f4e7e7] h-14 p-4" required />
        </div>

        <!-- Sex input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Sex <span class="text-sm text-[#9c4949] font-normal">(Biological differences may influence heart risk profiles)</span>
          </label>
          <select name="Sex" class="w-full rounded-xl bg-[#f4e7e7] h-12 px-4 py-2">
            <option value="1">Male</option>
            <option value="0">Female</option>
          </select>
        </div>

        <!-- Chest Pain Type input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Chest Pain Type <span class="text-sm text-[#9c4949] font-normal">(Different types carry different risk weights)</span>
          </label>
          <select name="ChestPainType" class="w-full rounded-xl bg-[#f4e7e7] h-12 px-4 py-2 text-base leading-tight">
            <option value="0">ATA (Typical Angina) - Classic chest pain related to heart</option>
            <option value="1">NAP (Non-Anginal Pain) - Chest pain not heart-related</option>
            <option value="2">TA (Atypical Angina) - Unusual chest pain patterns</option>
            <option value="3">ASY (Asymptomatic) - No chest pain symptoms</option>
          </select>
        </div>

        <!-- Resting Blood Pressure input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Resting BP (mmHg) <span class="text-sm text-[#9c4949] font-normal">(High blood pressure >140 strains the heart)</span>
          </label>
          <input type="number" name="RestingBP" placeholder="e.g. 120" class="w-full rounded-xl bg-[#f4e7e7] h-14 p-4" required />
        </div>

        <!-- Cholesterol input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Cholesterol (mg/dL) <span class="text-sm text-[#9c4949] font-normal">(Elevated levels >200 can lead to plaque in arteries)</span>
          </label>
          <input type="number" name="Cholesterol" placeholder="e.g. 200" class="w-full rounded-xl bg-[#f4e7e7] h-14 p-4" required />
        </div>

        <!-- Fasting Blood Sugar input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Fasting Blood Sugar <span class="text-sm text-[#9c4949] font-normal">(Levels >120 mg/dL may indicate diabetes risk)</span>
          </label>
          <select name="FastingBS" class="w-full rounded-xl bg-[#f4e7e7] h-12 px-4 py-2">
            <option value="0">‚â§ 120 mg/dL (Normal)</option>
            <option value="1">> 120 mg/dL (Elevated - Diabetes Risk)</option>
          </select>
        </div>

        <!-- Resting ECG input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Resting ECG <span class="text-sm text-[#9c4949] font-normal">(Detects electrical abnormalities in heart rhythm)</span>
          </label>
          <select name="RestingECG" class="w-full rounded-xl bg-[#f4e7e7] h-12 px-4 py-2">
            <option value="0">Normal (No abnormalities detected)</option>
            <option value="1">ST (ST-T wave abnormality)</option>
            <option value="2">LVH (Left ventricular hypertrophy - enlarged heart)</option>
          </select>
        </div>

        <!-- Max Heart Rate input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Max Heart Rate <span class="text-sm text-[#9c4949] font-normal">(Shows heart performance under exertion)</span>
          </label>
          <input type="number" name="MaxHR" placeholder="e.g. 150" class="w-full rounded-xl bg-[#f4e7e7] h-14 p-4" required />
        </div>

        <!-- Exercise Induced Angina input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Exercise Induced Angina <span class="text-sm text-[#9c4949] font-normal">(Chest pain during physical activity is a warning sign)</span>
          </label>
          <select name="ExerciseAngina" class="w-full rounded-xl bg-[#f4e7e7] h-12 px-4 py-2">
            <option value="0">No (No chest pain during exercise)</option>
            <option value="1">Yes (Chest pain occurs during exercise)</option>
          </select>
        </div>

        <!-- Oldpeak input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            Oldpeak <span class="text-sm text-[#9c4949] font-normal">(ST depression value from exercise ECG; higher values >1.0 indicate more risk)</span>
          </label>
          <input type="number" step="0.1" name="Oldpeak" placeholder="e.g. 1.5" class="w-full rounded-xl bg-[#f4e7e7] h-14 p-4" required />
        </div>

        <!-- ST Slope input -->
        <div>
          <label class="block text-[#1c0d0d] font-medium mb-1">
            ST Slope <span class="text-sm text-[#9c4949] font-normal">(Direction of ECG slope during exercise; upward is better)</span>
          </label>
          <select name="ST_Slope" class="w-full rounded-xl bg-[#f4e7e7] h-12 px-4 py-2">
            <option value="2">Up (Upsloping - Better prognosis)</option>
            <option value="1">Flat (Flat slope - Moderate risk)</option>
            <option value="0">Down (Downsloping - Higher risk)</option>
          </select>
        </div>

        <!-- Submit button -->
        <button type="submit" class="w-full bg-[#640505] text-[#fcf8f8] h-12 rounded-xl font-bold tracking-wide">
          Predict Heart Disease Risk
        </button>
      </form>

      <!-- Dynamic result box -->
      <div id="result" class="mt-6 text-lg font-medium text-[#1c0d0d]"></div>

      <!-- General Heart Health Tips Section -->
      <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-blue-800 mb-3">üí° General Heart Health Tips</h3>
        <div class="grid md:grid-cols-2 gap-4 text-sm text-blue-700">
          <div>
            <h4 class="font-medium">‚úÖ If Low Risk:</h4>
            <ul class="list-disc list-inside mt-1 space-y-1">
              <li>Maintain regular exercise (150 min/week)</li>
              <li>Eat a balanced diet</li>
              <li>Get annual checkups</li>
            </ul>
          </div>
          <div>
            <h4 class="font-medium">üö® If High Risk:</h4>
            <ul class="list-disc list-inside mt-1 space-y-1">
              <li>Consult a cardiologist immediately</li>
              <li>Start supervised exercise program</li>
              <li>Reduce sodium and saturated fats</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Disclaimer Box -->
      <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-xl p-4">
        <p class="text-yellow-800 text-sm text-center font-medium">
          ‚ö†Ô∏è <strong>Important:</strong> This tool is for educational purposes only and is not a medical device. 
          Always consult a licensed healthcare provider for medical advice and diagnosis.
        </p>
      </div>
    </div>

<!-- JavaScript to handle prediction -->
<script>
  const form = document.getElementById('predictForm');
  const resultBox = document.getElementById('result');
  const predictBtn = form.querySelector('button[type="submit"]');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    
    // Show loading state
    resultBox.innerHTML = 'üîç Assessing your risk...';
    predictBtn.disabled = true;
    predictBtn.textContent = 'Predicting...';

    const formData = new FormData(form);

    // Optional debug logging
    console.log('Form data being sent:');
    for (let [key, value] of formData.entries()) {
      console.log(key, value);
    }

    try {
      const response = await fetch('https://heart-risk-api.onrender.com/predict', {
        method: 'POST',
        body: formData,
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      console.log('Prediction result:', result);
      
      // Display result based on risk level
      if (result.prediction === "High Risk") {
        resultBox.innerHTML = `
          <div class="bg-red-50 border border-red-200 rounded-xl p-4">
            <div class="text-red-800 font-semibold text-xl mb-2">üö® High Risk of Heart Disease</div>
            <div class="text-red-700">
              <p class="mb-2">This assessment suggests you may be at higher risk for heart disease.</p>
              <p class="font-medium">Recommended actions:</p>
              <ul class="list-disc list-inside mt-1 space-y-1">
                <li>Schedule an appointment with a cardiologist or your primary care physician</li>
                <li>Discuss these results and your symptoms with a healthcare provider</li>
                <li>Consider lifestyle modifications under medical supervision</li>
              </ul>
            </div>
          </div>
        `;
      } else {
        resultBox.innerHTML = `
          <div class="bg-green-50 border border-green-200 rounded-xl p-4">
            <div class="text-green-800 font-semibold text-xl mb-2">‚úÖ Low Risk of Heart Disease</div>
            <div class="text-green-700">
              <p class="mb-2">This assessment suggests you may be at lower risk for heart disease.</p>
              <p class="font-medium">Continue healthy habits:</p>
              <ul class="list-disc list-inside mt-1 space-y-1">
                <li>Maintain regular physical activity</li>
                <li>Keep up with a heart-healthy diet</li>
                <li>Schedule regular health checkups</li>
              </ul>
            </div>
          </div>
        `;
      }
    } catch (error) {
      // Handle error
      resultBox.innerHTML = `
        <div class="bg-red-50 border border-red-200 rounded-xl p-4">
          <div class="text-red-800 font-semibold">‚ö†Ô∏è Error</div>
          <div class="text-red-700">Unable to connect to the prediction service. Please try again.</div>
        </div>
      `;
      console.error('Error:', error);
    } finally {
      // Re-enable button
      predictBtn.disabled = false;
      predictBtn.textContent = 'Predict Heart Disease Risk';
    }
  });
</script>
  </body>
</html>
